# ç¬¬5æ­¥å®Œæˆæ€»ç»“ - API æ–‡æ¡£é›†æˆ

> å®Œæˆæ—¶é—´: 2024-12-05 06:40  
> ä»»åŠ¡çŠ¶æ€: âœ… å·²å®Œæˆ

---

## ğŸ“‹ å®Œæˆå†…å®¹

### 1. Swagger Controller è£…é¥°å™¨æ·»åŠ 

å·²ä¸ºä»¥ä¸‹ Controller æ·»åŠ å®Œæ•´çš„ Swagger API æ–‡æ¡£è£…é¥°å™¨:

#### âœ… è®¤è¯æ¨¡å—
- **AuthController** - ç”¨æˆ·è®¤è¯ç›¸å…³æ¥å£
  - ç™»å½•æ¥å£ (`POST /auth/login`)
  - ç™»å‡ºæ¥å£ (`POST /auth/logout`)

#### âœ… ç³»ç»Ÿç®¡ç†æ¨¡å—
- **UserController** - ç”¨æˆ·ç®¡ç†
  - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ (`GET /system/user/getInfo`)
  - æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ (`GET /system/user`)
  - æŸ¥è¯¢ç”¨æˆ·è¯¦æƒ… (`GET /system/user/:userId`)
  - æ–°å¢ç”¨æˆ· (`POST /system/user`)
  - ä¿®æ”¹ç”¨æˆ· (`PUT /system/user/:userId`)
  - åˆ é™¤ç”¨æˆ· (`DELETE /system/user/:userId`)
  - é‡ç½®å¯†ç  (`PUT /system/user/resetPwd`)
  - ä¿®æ”¹çŠ¶æ€ (`PUT /system/user/changeStatus`)

- **RoleController** - è§’è‰²ç®¡ç†
  - æŸ¥è¯¢è§’è‰²åˆ—è¡¨ (`GET /system/role`)
  - æŸ¥è¯¢è§’è‰²è¯¦æƒ… (`GET /system/role/:roleId`)
  - æ–°å¢è§’è‰² (`POST /system/role`)
  - ä¿®æ”¹è§’è‰² (`PUT /system/role/:roleId`)
  - åˆ é™¤è§’è‰² (`DELETE /system/role/:roleId`)
  - ä¿®æ”¹çŠ¶æ€ (`PUT /system/role/changeStatus`)

- **DeptController** - éƒ¨é—¨ç®¡ç†
  - æŸ¥è¯¢éƒ¨é—¨åˆ—è¡¨ (`GET /system/dept`)
  - æŸ¥è¯¢éƒ¨é—¨è¯¦æƒ… (`GET /system/dept/:deptId`)
  - æŸ¥è¯¢éƒ¨é—¨åˆ—è¡¨(æ’é™¤èŠ‚ç‚¹) (`GET /system/dept/list/exclude/:deptId`)
  - æ–°å¢éƒ¨é—¨ (`POST /system/dept`)
  - ä¿®æ”¹éƒ¨é—¨ (`PUT /system/dept/:deptId`)
  - åˆ é™¤éƒ¨é—¨ (`DELETE /system/dept/:deptId`)

- **SystemMenuController** - èœå•ç®¡ç†
  - æŸ¥è¯¢èœå•åˆ—è¡¨ (`GET /system/menu`)
  - æŸ¥è¯¢èœå•è¯¦æƒ… (`GET /system/menu/:menuId`)
  - æŸ¥è¯¢èœå•ä¸‹æ‹‰æ ‘ (`GET /system/menu/treeselect`)
  - æŸ¥è¯¢è§’è‰²èœå•ä¸‹æ‹‰æ ‘ (`GET /system/menu/roleMenuTreeselect/:roleId`)
  - æ–°å¢èœå• (`POST /system/menu`)
  - ä¿®æ”¹èœå• (`PUT /system/menu/:menuId`)
  - åˆ é™¤èœå• (`DELETE /system/menu/:menuId`)

### 2. ä½¿ç”¨çš„è£…é¥°å™¨

æ¯ä¸ª Controller éƒ½æ·»åŠ äº†ä»¥ä¸‹è£…é¥°å™¨:

```typescript
// Controller çº§åˆ«
@ApiTags('æ¨¡å—åç§°')           // API åˆ†ç»„æ ‡ç­¾
@ApiBearerAuth('JWT-auth')    // JWT è®¤è¯æ ‡è¯†
@UseGuards(JwtAuthGuard)      // è·¯ç”±å®ˆå«

// æ–¹æ³•çº§åˆ«
@ApiOperation({ summary: 'æ¥å£è¯´æ˜' })                    // æ¥å£æè¿°
@ApiParam({ name: 'å‚æ•°å', description: 'å‚æ•°è¯´æ˜' })    // è·¯å¾„å‚æ•°
@ApiBody({ type: DtoClass })                              // è¯·æ±‚ä½“
@ApiResponse({ status: 200, description: 'å“åº”è¯´æ˜' })    // å“åº”çŠ¶æ€
```

### 3. monorepo.sh ä¼˜åŒ–

ä¼˜åŒ–äº†é¡¹ç›®å¯åŠ¨è„šæœ¬,ç°åœ¨ä¼šæ˜¾ç¤ºè®¿é—®åœ°å€:

**å¯åŠ¨å‰ç«¯æ—¶æ˜¾ç¤º:**
```
âœ“ å‰ç«¯å¯åŠ¨æˆåŠŸ
  âœ å‰ç«¯è®¿é—®åœ°å€: http://localhost:5173
```

**å¯åŠ¨åç«¯æ—¶æ˜¾ç¤º:**
```
âœ“ åç«¯å¯åŠ¨æˆåŠŸ
  âœ åç«¯ API åœ°å€: http://localhost:3000
  âœ API æ–‡æ¡£åœ°å€: http://localhost:3000/api-docs
```

**æŸ¥çœ‹çŠ¶æ€æ—¶æ˜¾ç¤º:**
```
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å‰ç«¯çŠ¶æ€ï¼šè¿è¡Œä¸­ (pid: 12345, port: 5173)
  âœ è®¿é—®åœ°å€: http://localhost:5173

åç«¯çŠ¶æ€ï¼šè¿è¡Œä¸­ (pid: 12346, port: 3000)
  âœ API åœ°å€: http://localhost:3000
  âœ API æ–‡æ¡£: http://localhost:3000/api-docs
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

---

## ğŸ“Š ä¿®æ”¹æ–‡ä»¶æ¸…å•

### æ–°å¢è£…é¥°å™¨çš„æ–‡ä»¶ (5ä¸ª)
1. `server-nestjs/src/auth/auth.controller.ts` - è®¤è¯æ§åˆ¶å™¨
2. `server-nestjs/src/system/user/user.controller.ts` - ç”¨æˆ·æ§åˆ¶å™¨
3. `server-nestjs/src/system/role/role.controller.ts` - è§’è‰²æ§åˆ¶å™¨
4. `server-nestjs/src/system/dept/dept.controller.ts` - éƒ¨é—¨æ§åˆ¶å™¨
5. `server-nestjs/src/system/menu/system-menu.controller.ts` - èœå•æ§åˆ¶å™¨

### ä¼˜åŒ–çš„è„šæœ¬æ–‡ä»¶ (1ä¸ª)
1. `monorepo.sh` - é¡¹ç›®å¯åŠ¨è„šæœ¬

### æ›´æ–°çš„æ–‡æ¡£ (2ä¸ª)
1. `docs/é€šç”¨/é¡¹ç›®ä¼˜åŒ–TODOæ¸…å•.md` - æ ‡è®°ä»»åŠ¡å®Œæˆ
2. `docs/é€šç”¨/ç¬¬5æ­¥å®Œæˆæ€»ç»“.md` - æœ¬æ–‡æ¡£

---

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### 1. å¯åŠ¨é¡¹ç›®

```bash
# ä¸€é”®å¯åŠ¨å‰åç«¯
./monorepo.sh

# é€‰æ‹© 1 (ä¸€é”®å¯åŠ¨å‰ç«¯+åç«¯)
```

å¯åŠ¨åä¼šè‡ªåŠ¨æ˜¾ç¤ºè®¿é—®åœ°å€ã€‚

### 2. è®¿é—® Swagger API æ–‡æ¡£

æµè§ˆå™¨è®¿é—®: **http://localhost:3000/api-docs**

### 3. æµ‹è¯• API

#### æ–¹å¼ä¸€: ä½¿ç”¨ Swagger UI

1. è®¿é—® http://localhost:3000/api-docs
2. ç‚¹å‡»å³ä¸Šè§’ "Authorize" æŒ‰é’®
3. å…ˆè°ƒç”¨ `/auth/login` æ¥å£ç™»å½•
   - username: `admin`
   - password: `admin123`
4. å¤åˆ¶è¿”å›çš„ `token` å€¼
5. åœ¨è®¤è¯å¯¹è¯æ¡†ä¸­è¾“å…¥: `Bearer <your-token>`
6. ç‚¹å‡» "Authorize" å®Œæˆè®¤è¯
7. ç°åœ¨å¯ä»¥æµ‹è¯•æ‰€æœ‰éœ€è¦è®¤è¯çš„æ¥å£

#### æ–¹å¼äºŒ: ä½¿ç”¨ curl

```bash
# 1. ç™»å½•è·å– token
TOKEN=$(curl -X POST http://localhost:3000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}' \
  | jq -r '.token')

# 2. ä½¿ç”¨ token è®¿é—®æ¥å£
curl http://localhost:3000/system/user/getInfo \
  -H "Authorization: Bearer $TOKEN"
```

### 4. å¯¼å‡º API æ–‡æ¡£

```bash
# å¯¼å‡º JSON æ ¼å¼
curl http://localhost:3000/api-docs-json > api-docs.json

# ä½¿ç”¨ jq æ ¼å¼åŒ–æŸ¥çœ‹
curl http://localhost:3000/api-docs-json | jq
```

---

## ğŸ“ˆ è¦†ç›–æƒ…å†µ

### å·²å®Œæˆ (5ä¸ªæ¨¡å—)
- âœ… è®¤è¯æ¨¡å— (AuthController)
- âœ… ç”¨æˆ·ç®¡ç† (UserController)
- âœ… è§’è‰²ç®¡ç† (RoleController)
- âœ… éƒ¨é—¨ç®¡ç† (DeptController)
- âœ… èœå•ç®¡ç† (SystemMenuController)

### å¾…å®Œæˆ (å¯é€‰)
ä»¥ä¸‹ Controller å¯ä»¥å‚è€ƒå·²å®Œæˆçš„æ¨¡å—è‡ªè¡Œæ·»åŠ :

- â³ å²—ä½ç®¡ç† (PostController)
- â³ å­—å…¸ç®¡ç† (DictController, DictDataController)
- â³ å‚æ•°é…ç½® (ConfigController)
- â³ é€šçŸ¥å…¬å‘Š (NoticeController)
- â³ åœ¨çº¿ç”¨æˆ· (OnlineController)
- â³ ç™»å½•æ—¥å¿— (LogininforController)
- â³ æ“ä½œæ—¥å¿— (OperlogController)
- â³ æœåŠ¡ç›‘æ§ (ServerController)
- â³ ç¼“å­˜ç›‘æ§ (CacheController)
- â³ å®šæ—¶ä»»åŠ¡ (JobController)

---

## ğŸ’¡ æ·»åŠ è£…é¥°å™¨æ¨¡æ¿

å¦‚æœéœ€è¦ä¸ºå…¶ä»– Controller æ·»åŠ è£…é¥°å™¨,å¯ä»¥å‚è€ƒä»¥ä¸‹æ¨¡æ¿:

```typescript
import { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth, ApiParam, ApiBody } from '@nestjs/swagger';

@ApiTags('æ¨¡å—åç§°')
@ApiBearerAuth('JWT-auth')
@UseGuards(JwtAuthGuard)
@Controller('è·¯å¾„')
export class XxxController {
  
  @Get()
  @ApiOperation({ summary: 'æŸ¥è¯¢åˆ—è¡¨' })
  @ApiResponse({ status: 200, description: 'æŸ¥è¯¢æˆåŠŸ' })
  findAll(@Query() query: QueryDto) {
    // ...
  }

  @Get(':id')
  @ApiOperation({ summary: 'æŸ¥è¯¢è¯¦æƒ…' })
  @ApiParam({ name: 'id', description: 'ID' })
  @ApiResponse({ status: 200, description: 'æŸ¥è¯¢æˆåŠŸ' })
  findOne(@Param('id') id: string) {
    // ...
  }

  @Post()
  @ApiOperation({ summary: 'æ–°å¢' })
  @ApiBody({ type: CreateDto })
  @ApiResponse({ status: 201, description: 'åˆ›å»ºæˆåŠŸ' })
  create(@Body() createDto: CreateDto) {
    // ...
  }

  @Put(':id')
  @ApiOperation({ summary: 'ä¿®æ”¹' })
  @ApiParam({ name: 'id', description: 'ID' })
  @ApiBody({ type: UpdateDto })
  @ApiResponse({ status: 200, description: 'ä¿®æ”¹æˆåŠŸ' })
  update(@Param('id') id: string, @Body() updateDto: UpdateDto) {
    // ...
  }

  @Delete(':id')
  @ApiOperation({ summary: 'åˆ é™¤' })
  @ApiParam({ name: 'id', description: 'ID' })
  @ApiResponse({ status: 200, description: 'åˆ é™¤æˆåŠŸ' })
  remove(@Param('id') id: string) {
    // ...
  }
}
```

---

## ğŸ‰ æˆæœå±•ç¤º

### Swagger UI ç•Œé¢

è®¿é—® http://localhost:3000/api-docs å¯ä»¥çœ‹åˆ°:

1. **API åˆ†ç»„** - æŒ‰æ¨¡å—åˆ†ç±»å±•ç¤º
   - è®¤è¯
   - ç”¨æˆ·ç®¡ç†
   - è§’è‰²ç®¡ç†
   - éƒ¨é—¨ç®¡ç†
   - èœå•ç®¡ç†

2. **æ¥å£è¯¦æƒ…** - æ¯ä¸ªæ¥å£éƒ½æœ‰è¯¦ç»†è¯´æ˜
   - æ¥å£è·¯å¾„å’Œæ–¹æ³•
   - è¯·æ±‚å‚æ•°è¯´æ˜
   - è¯·æ±‚ä½“ç»“æ„
   - å“åº”çŠ¶æ€ç 
   - ç¤ºä¾‹æ•°æ®

3. **åœ¨çº¿æµ‹è¯•** - å¯ä»¥ç›´æ¥åœ¨é¡µé¢æµ‹è¯•
   - å¡«å†™å‚æ•°
   - å‘é€è¯·æ±‚
   - æŸ¥çœ‹å“åº”

4. **JWT è®¤è¯** - æ”¯æŒ Bearer Token
   - ä¸€æ¬¡è®¤è¯
   - å…¨å±€ç”Ÿæ•ˆ

### å¯åŠ¨è„šæœ¬ä¼˜åŒ–

è¿è¡Œ `./monorepo.sh` å:

```
å‰ç«¯å¯åŠ¨æˆåŠŸ
  âœ å‰ç«¯è®¿é—®åœ°å€: http://localhost:5173

åç«¯å¯åŠ¨æˆåŠŸ
  âœ åç«¯ API åœ°å€: http://localhost:3000
  âœ API æ–‡æ¡£åœ°å€: http://localhost:3000/api-docs
```

ä¸€ç›®äº†ç„¶,å¼€å‘ä½“éªŒæ›´å¥½!

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Swagger APIæ–‡æ¡£é…ç½®æŒ‡å—](../åç«¯/Swagger%20APIæ–‡æ¡£é…ç½®æŒ‡å—.md)
- [é¡¹ç›®ä¼˜åŒ–TODOæ¸…å•](./é¡¹ç›®ä¼˜åŒ–TODOæ¸…å•.md)
- [é¡¹ç›®ä¼˜åŒ–å®Œæˆæ€»ç»“](./é¡¹ç›®ä¼˜åŒ–å®Œæˆæ€»ç»“.md)

---

## âœ… ä»»åŠ¡å®Œæˆæ£€æŸ¥

- [x] ä¸º AuthController æ·»åŠ è£…é¥°å™¨
- [x] ä¸º UserController æ·»åŠ è£…é¥°å™¨
- [x] ä¸º RoleController æ·»åŠ è£…é¥°å™¨
- [x] ä¸º DeptController æ·»åŠ è£…é¥°å™¨
- [x] ä¸º SystemMenuController æ·»åŠ è£…é¥°å™¨
- [x] ä¼˜åŒ– monorepo.sh æ˜¾ç¤ºè®¿é—®åœ°å€
- [x] æ›´æ–° TODO æ¸…å•
- [x] ç¼–å†™å®Œæˆæ€»ç»“æ–‡æ¡£

**ç¬¬5æ­¥ä»»åŠ¡åœ†æ»¡å®Œæˆ!** ğŸŠ

---

**æœ€åæ›´æ–°**: 2024-12-05 06:40
