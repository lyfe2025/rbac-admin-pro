# å‰ç«¯é”™è¯¯å¤„ç†ä¼˜åŒ–

## é—®é¢˜åˆ†æ

### é”™è¯¯ä¿¡æ¯
```
[Vue warn]: Unhandled error during execution of native event handler
```

### åŸå› 
éƒ¨åˆ† `handleSubmit` å‡½æ•°ç¼ºå°‘ `catch` å—,å¯¼è‡´å¼‚æ­¥é”™è¯¯æœªè¢«æ•è·ã€‚

## è§£å†³æ–¹æ¡ˆ

### 1. âœ… å·²ä¿®å¤çš„æ–‡ä»¶ (å…¨éƒ¨å®Œæˆ)

æ‰€æœ‰æ–‡ä»¶çš„ `handleSubmit` å‡½æ•°å·²æ·»åŠ é”™è¯¯å¤„ç†:

- âœ… `views/system/user/index.vue` - ç”¨æˆ·ç®¡ç†
- âœ… `views/system/role/index.vue` - è§’è‰²ç®¡ç†
- âœ… `views/system/menu/index.vue` - èœå•ç®¡ç†
- âœ… `views/system/dept/index.vue` - éƒ¨é—¨ç®¡ç†
- âœ… `views/system/post/index.vue` - å²—ä½ç®¡ç†
- âœ… `views/system/config/index.vue` - å‚æ•°é…ç½®
- âœ… `views/system/notice/index.vue` - é€šçŸ¥å…¬å‘Š
- âœ… `views/monitor/job/index.vue` - å®šæ—¶ä»»åŠ¡

### 2. ğŸ‰ ä¿®å¤å®Œæˆ

æ‰€æœ‰å¾…ä¿®å¤æ–‡ä»¶å·²å®Œæˆé”™è¯¯å¤„ç†æ·»åŠ !

### 3. ä¿®å¤æ¨¡æ¿

```typescript
async function handleSubmit() {
  // 1. è¡¨å•éªŒè¯
  if (!form.requiredField) {
    toast({
      title: "éªŒè¯å¤±è´¥",
      description: "å¿…å¡«å­—æ®µä¸èƒ½ä¸ºç©º",
      variant: "destructive"
    })
    return
  }

  // 2. æäº¤é€»è¾‘
  submitLoading.value = true
  try {
    if (form.id) {
      await updateData(form)
      toast({ title: "ä¿®æ”¹æˆåŠŸ", description: "æ•°æ®å·²æ›´æ–°" })
    } else {
      await addData(form)
      toast({ title: "æ–°å¢æˆåŠŸ", description: "æ•°æ®å·²åˆ›å»º" })
    }
    showDialog.value = false
    getList()
  } catch (error) {
    // é”™è¯¯å·²ç”±è¯·æ±‚æ‹¦æˆªå™¨å¤„ç†,è¿™é‡Œåªéœ€è®°å½•æ—¥å¿—
    console.error('æäº¤å¤±è´¥:', error)
  } finally {
    submitLoading.value = false
  }
}
```

## å·¥å…·å‡½æ•°

### error-handler.ts

å·²åˆ›å»º `src/utils/error-handler.ts`,æä¾›ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å·¥å…·:

#### 1. handleError - å¤„ç†å•ä¸ªé”™è¯¯
```typescript
import { handleError } from '@/utils/error-handler'

try {
  await someOperation()
} catch (error) {
  handleError(error, 'OperationName')
}
```

#### 2. withErrorHandler - åŒ…è£…å‡½æ•°
```typescript
import { withErrorHandler } from '@/utils/error-handler'

const safeSubmit = withErrorHandler(handleSubmit, 'FormSubmit')

// ä½¿ç”¨
<Button @click="safeSubmit">æäº¤</Button>
```

#### 3. safeAsync - å®‰å…¨æ‰§è¡Œ
```typescript
import { safeAsync } from '@/utils/error-handler'

const data = await safeAsync(
  () => fetchData(),
  {
    context: 'FetchData',
    defaultValue: [],
    onError: (error) => {
      console.log('è‡ªå®šä¹‰é”™è¯¯å¤„ç†', error)
    }
  }
)
```

## æœ€ä½³å®è·µ

### 1. æ‰€æœ‰å¼‚æ­¥æ“ä½œéƒ½è¦æœ‰é”™è¯¯å¤„ç†

```typescript
// âœ… å¥½çš„åšæ³•
async function handleClick() {
  try {
    await someAsyncOperation()
  } catch (error) {
    console.error('æ“ä½œå¤±è´¥:', error)
  }
}

// âŒ é¿å…
async function handleClick() {
  await someAsyncOperation() // å¯èƒ½æŠ›å‡ºæœªæ•è·çš„é”™è¯¯
}
```

### 2. ä½¿ç”¨ finally æ¸…ç†çŠ¶æ€

```typescript
async function handleSubmit() {
  loading.value = true
  try {
    await submitData()
  } catch (error) {
    console.error('æäº¤å¤±è´¥:', error)
  } finally {
    loading.value = false // ç¡®ä¿çŠ¶æ€è¢«é‡ç½®
  }
}
```

### 3. é”™è¯¯ä¿¡æ¯è¦æ¸…æ™°

```typescript
// âœ… å¥½çš„åšæ³•
catch (error) {
  console.error('ç”¨æˆ·åˆ›å»ºå¤±è´¥:', error)
  toast({
    title: "åˆ›å»ºå¤±è´¥",
    description: error.message || "è¯·ç¨åé‡è¯•",
    variant: "destructive"
  })
}

// âŒ é¿å…
catch (error) {
  console.log(error) // ä¿¡æ¯ä¸å¤Ÿæ˜ç¡®
}
```

### 4. åŒºåˆ†ä¸åŒç±»å‹çš„é”™è¯¯

```typescript
try {
  await submitData()
} catch (error) {
  if (error.response?.status === 401) {
    // æœªæˆæƒ,è·³è½¬ç™»å½•
    router.push('/login')
  } else if (error.response?.status === 403) {
    // æ— æƒé™
    toast({ title: "æ— æƒé™", variant: "destructive" })
  } else {
    // å…¶ä»–é”™è¯¯
    console.error('æäº¤å¤±è´¥:', error)
  }
}
```

## éªŒè¯ä¿®å¤

### 1. æ£€æŸ¥æ§åˆ¶å°
ä¿®å¤å,æµè§ˆå™¨æ§åˆ¶å°ä¸åº”å†å‡ºç° Vue è­¦å‘Šã€‚

### 2. æµ‹è¯•åœºæ™¯
- æäº¤è¡¨å•æ—¶ç½‘ç»œæ–­å¼€
- æäº¤æ— æ•ˆæ•°æ®
- æœåŠ¡å™¨è¿”å›é”™è¯¯
- æƒé™ä¸è¶³

### 3. é¢„æœŸè¡Œä¸º
- é”™è¯¯è¢«æ­£ç¡®æ•è·
- æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º
- åŠ è½½çŠ¶æ€æ­£ç¡®é‡ç½®
- ä¸å½±å“å…¶ä»–åŠŸèƒ½

## æ‰¹é‡ä¿®å¤

### ä½¿ç”¨è„šæœ¬
```bash
cd web
chmod +x scripts/fix-error-handlers.sh
./scripts/fix-error-handlers.sh
```

### æ‰‹åŠ¨ä¿®å¤
1. æ‰“å¼€æ–‡ä»¶
2. æ‰¾åˆ° `async function handleSubmit()`
3. æ£€æŸ¥æ˜¯å¦æœ‰ `catch` å—
4. å¦‚æœæ²¡æœ‰,åœ¨ `try` å—åæ·»åŠ :
   ```typescript
   } catch (error) {
     console.error('æäº¤å¤±è´¥:', error)
   } finally {
   ```

## ç›¸å…³æ–‡æ¡£

- [Vue é”™è¯¯å¤„ç†](https://vuejs.org/guide/best-practices/production-deployment.html#tracking-runtime-errors)
- [Axios é”™è¯¯å¤„ç†](https://axios-http.com/docs/handling_errors)
- [TypeScript é”™è¯¯å¤„ç†](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-4.html#control-flow-analysis-of-aliased-conditions)

## æ›´æ–°æ—¥å¿—

- 2024-12-05 06:15: âœ… å®Œæˆæ‰€æœ‰8ä¸ªæ–‡ä»¶çš„é”™è¯¯å¤„ç†ä¿®å¤
- 2024-12-05 06:10: âœ… ä¿®å¤ç”¨æˆ·ç®¡ç†å’Œè§’è‰²ç®¡ç†é¡µé¢
- 2024-12-05 06:10: âœ… åˆ›å»ºé”™è¯¯å¤„ç†å·¥å…·å‡½æ•°
- 2024-12-05 06:10: âœ… åˆ›å»ºä¿®å¤è„šæœ¬å’Œæ–‡æ¡£
