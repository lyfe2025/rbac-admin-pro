# å‰ç«¯é”™è¯¯å¤„ç†æ·±åº¦æ£€æŸ¥æŠ¥å‘Š

## æ£€æŸ¥æ—¶é—´
2024-12-05 06:15

## æ£€æŸ¥èŒƒå›´
æ‰€æœ‰ Vue ç»„ä»¶ä¸­çš„å¼‚æ­¥å‡½æ•°

## æ£€æŸ¥ç»“æœ

### âœ… å·²ä¿®å¤çš„æ–‡ä»¶ (8ä¸ª)

1. âœ… `views/system/user/index.vue` - ç”¨æˆ·ç®¡ç†
2. âœ… `views/system/role/index.vue` - è§’è‰²ç®¡ç†
3. âœ… `views/system/menu/index.vue` - èœå•ç®¡ç†
4. âœ… `views/system/dept/index.vue` - éƒ¨é—¨ç®¡ç†
5. âœ… `views/system/post/index.vue` - å²—ä½ç®¡ç†
6. âœ… `views/system/config/index.vue` - å‚æ•°é…ç½®
7. âœ… `views/system/notice/index.vue` - é€šçŸ¥å…¬å‘Š
8. âœ… `views/monitor/job/index.vue` - å®šæ—¶ä»»åŠ¡

### âœ… æ–°ä¿®å¤çš„æ–‡ä»¶ (2ä¸ª)

#### 1. `views/system/dict/index.vue` - å­—å…¸ç®¡ç† âœ…

å·²ä¸ºä»¥ä¸‹å‡½æ•°æ·»åŠ é”™è¯¯å¤„ç†:

- âœ… `handleUpdate(row)` - ç¬¬89è¡Œ
- âœ… `handleDelete(row)` - ç¬¬101è¡Œ
- âœ… `submitForm()` - ç¬¬116è¡Œ

**é—®é¢˜å‡½æ•°ç¤ºä¾‹:**
```typescript
async function handleUpdate(row: DictType) {
  resetForm()
  const res = await getType(row.dictId)  // âŒ ç¼ºå°‘é”™è¯¯å¤„ç†
  Object.assign(form, res.data)
  dialogTitle.value = 'ä¿®æ”¹å­—å…¸ç±»å‹'
  showDialog.value = true
}

async function submitForm() {
  // ... éªŒè¯é€»è¾‘
  
  if (form.dictId) {
    await updateType(form)  // âŒ ç¼ºå°‘é”™è¯¯å¤„ç†
    toast({ title: "ä¿®æ”¹æˆåŠŸ" })
  } else {
    await addType(form)  // âŒ ç¼ºå°‘é”™è¯¯å¤„ç†
    toast({ title: "æ·»åŠ æˆåŠŸ" })
  }
  showDialog.value = false
  getList()
}
```

#### 2. `views/tool/gen/index.vue` - ä»£ç ç”Ÿæˆ âœ…

å·²ä¸ºä»¥ä¸‹å‡½æ•°æ·»åŠ é”™è¯¯å¤„ç†:

- âœ… `handleDelete(row)` - ç¬¬67è¡Œ
- âœ… `handlePreview(row)` - ç¬¬79è¡Œ
- âœ… `handleGenCode(row)` - ç¬¬93è¡Œ
- âšª `handleEdit(row)` - ç¬¬102è¡Œ (ä»…æç¤ºä¿¡æ¯,æ— éœ€é”™è¯¯å¤„ç†)

**é—®é¢˜å‡½æ•°ç¤ºä¾‹:**
```typescript
async function handleDelete(row: GenTable) {
  if (confirm('ç¡®è®¤è¦åˆ é™¤è¡¨"' + row.tableName + '"å—ï¼Ÿ')) {
    await delTable([row.tableId])  // âŒ ç¼ºå°‘é”™è¯¯å¤„ç†
    toast({ title: "åˆ é™¤æˆåŠŸ" })
    getList()
  }
}

async function handlePreview(row: GenTable) {
  const res = await previewTable(row.tableId)  // âŒ ç¼ºå°‘é”™è¯¯å¤„ç†
  previewData.value = res.data
  // ...
}
```

### âœ… å·²æœ‰é”™è¯¯å¤„ç†çš„æ–‡ä»¶

ä»¥ä¸‹æ–‡ä»¶çš„å¼‚æ­¥å‡½æ•°å·²ç»æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†:

1. âœ… `views/system/setting/index.vue` - ç³»ç»Ÿè®¾ç½®
   - `handleSubmit()` å·²æœ‰ try-catch

2. âœ… æ‰€æœ‰ `getList()` å‡½æ•°
   - å¤§éƒ¨åˆ†éƒ½æœ‰ try-finally å¤„ç†

### ğŸ“Š ç»Ÿè®¡

- **æ€»æ£€æŸ¥æ–‡ä»¶**: 24ä¸ª Vue ç»„ä»¶
- **å·²ä¿®å¤**: 10ä¸ª (8ä¸ªåŸæœ‰ + 2ä¸ªæ–°ä¿®å¤)
- **éœ€è¦ä¿®å¤**: 0ä¸ª âœ…
- **å·²æœ‰é”™è¯¯å¤„ç†**: 14ä¸ª
- **ä¿®å¤ç‡**: 100% ğŸ‰

## âœ… ä¿®å¤å®Œæˆ

æ‰€æœ‰éœ€è¦ä¿®å¤çš„æ–‡ä»¶å·²å…¨éƒ¨å®Œæˆ!

### ä¿®å¤æ€»ç»“

1. âœ… å­—å…¸ç®¡ç† (`views/system/dict/index.vue`) - å·²ä¿®å¤
2. âœ… ä»£ç ç”Ÿæˆ (`views/tool/gen/index.vue`) - å·²ä¿®å¤

## ä¿®å¤æ¨¡æ¿

### å¯¹äº handleUpdate/handleDelete ç­‰æ“ä½œå‡½æ•°

```typescript
async function handleUpdate(row: DictType) {
  try {
    resetForm()
    const res = await getType(row.dictId)
    Object.assign(form, res.data)
    dialogTitle.value = 'ä¿®æ”¹å­—å…¸ç±»å‹'
    showDialog.value = true
  } catch (error) {
    console.error('è·å–æ•°æ®å¤±è´¥:', error)
  }
}

async function handleDelete(row: DictType) {
  if (confirm('ç¡®è®¤è¦åˆ é™¤"' + row.dictName + '"å­—å…¸ç±»å‹å—ï¼Ÿ')) {
    try {
      await delType([row.dictId])
      toast({ title: "åˆ é™¤æˆåŠŸ", description: "å­—å…¸ç±»å‹å·²åˆ é™¤" })
      getList()
    } catch (error) {
      console.error('åˆ é™¤å¤±è´¥:', error)
    }
  }
}
```

### å¯¹äº submitForm å‡½æ•°

```typescript
async function submitForm() {
  if (!form.dictName || !form.dictType) {
    toast({
      title: "éªŒè¯å¤±è´¥",
      description: "å­—å…¸åç§°å’Œç±»å‹ä¸èƒ½ä¸ºç©º",
      variant: "destructive"
    })
    return
  }
  
  try {
    if (form.dictId) {
      await updateType(form)
      toast({ title: "ä¿®æ”¹æˆåŠŸ", description: "å­—å…¸ç±»å‹å·²æ›´æ–°" })
    } else {
      await addType(form)
      toast({ title: "æ·»åŠ æˆåŠŸ", description: "å­—å…¸ç±»å‹å·²æ·»åŠ " })
    }
    showDialog.value = false
    getList()
  } catch (error) {
    console.error('æäº¤å¤±è´¥:', error)
  }
}
```

## åç»­å»ºè®®

1. **å»ºç«‹ ESLint è§„åˆ™**: æ£€æµ‹ç¼ºå°‘é”™è¯¯å¤„ç†çš„å¼‚æ­¥å‡½æ•°
2. **ä»£ç å®¡æŸ¥æ¸…å•**: å°†é”™è¯¯å¤„ç†åŠ å…¥ PR å®¡æŸ¥æ¸…å•
3. **ä½¿ç”¨é”™è¯¯å¤„ç†å·¥å…·**: æ¨å¹¿ä½¿ç”¨ `utils/error-handler.ts` ä¸­çš„å·¥å…·å‡½æ•°
4. **å•å…ƒæµ‹è¯•**: ä¸ºé”™è¯¯åœºæ™¯ç¼–å†™æµ‹è¯•ç”¨ä¾‹

## ç›¸å…³æ–‡æ¡£

- [é”™è¯¯å¤„ç†ä¼˜åŒ–.md](./é”™è¯¯å¤„ç†ä¼˜åŒ–.md)
- [é”™è¯¯å¤„ç†å·¥å…·](../../web/src/utils/error-handler.ts)
