# 📅 RBAC Admin Pro 全栈开发路线图

本文档详细规划了从 Mock 模式迁移到 NestJS 全栈模式的开发任务清单。我们将采用 **"基础设施 -> 核心认证 -> 系统模块 -> 业务功能"** 的顺序稳步推进。

## 🟢 第一阶段：基础设施与数据库搭建 (Infrastructure)
**目标**: 跑通后端连接，完成数据库初始化。

- [ ] **1.1 环境准备**
    - [ ] 确认本地 PostgreSQL 数据库已安装 (推荐 v14+)。
    - [ ] 创建数据库 `rbac_admin_pro`。
- [ ] **1.2 ORM 集成 (Prisma)**
    - [ ] 在 `server-nestjs` 初始化 Prisma: `npx prisma init`。
    - [ ] 配置 `.env` 数据库连接串。
    - [ ] 将 `db/schema.sql` 转换为 Prisma Schema (`schema.prisma`)。
    - [ ] 执行 Migration 同步表结构。
- [ ] **1.3 数据初始化 (Seeding)**
    - [ ] 编写 Seed 脚本 (`prisma/seed.ts`)。
    - [ ] 迁移 `db/init_data.sql` 中的初始数据（管理员账号、基础菜单、字典）。
- [ ] **1.4 统一响应封装**
    - [ ] 实现 NestJS 拦截器 (Interceptor) 统一返回 `{ code: 200, msg: 'success', data: ... }` 格式，确保与前端 Mock 数据结构一致。
    - [ ] 实现全局异常过滤器 (Filter)。

## 🟡 第二阶段：认证与权限核心 (Auth Core)
**目标**: 替换前端登录逻辑，实现真实的 JWT 鉴权。

- [ ] **2.1 登录接口 (`/auth/login`)**
    - [ ] 实现 `AuthModule` 和 `AuthService`。
    - [ ] 验证用户名/密码 (BCrypt 加密)。
    - [ ] 生成 JWT Token。
    - [ ] 验证码接口 (可选，初期可先跳过)。
- [ ] **2.2 用户信息接口 (`/system/user/getInfo`)**
    - [ ] 解析 Token 获取当前 UserId。
    - [ ] 查询用户 角色 (Roles) 和 权限标识 (Permissions)。
    - [ ] 返回前端需要的 `user`, `roles`, `permissions` 结构。
- [ ] **2.3 动态路由接口 (`/getRouters`)** 🌟 *核心难点*
    - [ ] 查询 `sys_menu` 表。
    - [ ] 实现 listToTree 算法，将扁平菜单数据转换为树形路由结构。
    - [ ] 适配前端 Vue Router 的 `component` 路径规则。
- [ ] **2.4 前端联调**
    - [ ] 修改前端 `.env.development`，将 API 指向 NestJS 后端。
    - [ ] 验证登录、页面跳转、菜单加载是否正常。

## 🔵 第三阶段：系统管理模块 (System Modules)
**目标**: 完成基础数据的增删改查 (CRUD)，替代 `src/api/system` 下的 Mock。

- [ ] **3.1 用户管理 (`/system/user`)**
    - [ ] 列表查询 (分页 + 搜索)。
    - [ ] 新增/修改/删除用户。
    - [ ] 重置密码。
- [ ] **3.2 角色管理 (`/system/role`)**
    - [ ] 角色 CRUD。
    - [ ] **数据权限**: 保存角色对应的菜单 ID 列表 (`sys_role_menu`)。
- [ ] **3.3 菜单管理 (`/system/menu`)**
    - [ ] 菜单树形列表。
    - [ ] 菜单的新增/修改/删除 (需处理父子关系)。
- [ ] **3.4 部门管理 (`/system/dept`)**
    - [ ] 部门树形结构 API。
- [ ] **3.5 字典与参数 (`/system/dict`, `/system/config`)**
    - [ ] 字典类型与字典数据管理。
    - [ ] 系统参数配置。

## 🟣 第四阶段：监控与日志 (Monitor & Logs)
**目标**: 实现系统运维能力。

- [ ] **4.1 操作日志**
    - [ ] 实现全局日志拦截器，自动记录用户操作到 `sys_oper_log` 表。
- [ ] **4.2 登录日志**
    - [ ] 记录登录成功/失败信息到 `sys_logininfor` 表。
- [ ] **4.3 在线用户**
    - [ ] 基于 Redis 统计当前在线 Token (可选)。

## ⚪ 第五阶段：部署与优化 (Deploy)
**目标**: 生产环境准备。

- [ ] **5.1 Docker 化**
    - [ ] 编写 `Dockerfile` (Web & Server)。
    - [ ] 编写 `docker-compose.yml` 一键启动数据库和应用。
- [ ] **5.2 生产构建**
    - [ ] 前端构建优化 (Gzip, CDN)。
    - [ ] 后端生产环境配置。

---

## 📌 执行建议

建议按照 **"一个接口，一次联调"** 的节奏进行：
1. 后端写好一个 Controller (如 `Login`).
2. 使用 Postman/Swagger 测试通过.
3. 前端切换该接口的 API 调用.
4. 验证无误后，Commit 代码，再进行下一个.
